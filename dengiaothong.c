#INCLUDE <16F887.H>
#FUSES HS
#USE DELAY (CLOCK = 20M)

#DEFINE SER PIN_D0
#DEFINE SCK PIN_D1
#DEFINE RCK PIN_D2

#DEFINE X1_D2 0X11 //0001 0001
#DEFINE V1_D2 0X14 //0000 0001
#DEFINE D1_X2 0X0A //0000 1010
#DEFINE D1_V2 0X22 //0010 0010

#DEFINE TG_DO 29
#DEFINE TG_XANH 26
#DEFINE TG_VANG 2

VOID XUAT (UNSIGNED INT8 BYTEXUAT)
{
   UNSIGNED INT8 I;
   #BIT BSER = BYTEXUAT.7
   
   FOR (I = 0; I < 8; I++)
   {
      OUTPUT_BIT(SER,BSER);
      OUTPUT_LOW(SCK);
      OUTPUT_HIGH(SCK);
      BYTEXUAT = BYTEXUAT<<1;
   }
}
VOID XUATLED7DOAN (UNSIGNED INT8 LED4, LED3, LED2, LED1)
{
   XUAT (LED4);
   XUAT (LED3);
   XUAT (LED2);
   XUAT (LED1);
   OUTPUT_LOW (RCK);
   OUTPUT_HIGH (RCK);
}
UNSIGNED INT8 DEM1, DEM2;
UNSIGNED INT8 MA7D[10]={0XC0,0XF9,0XA4,0XB0,0X99,0X92,0X82,0XF8,0X80,0X90};

VOID MAIN()
{
   SET_TRIS_D(0X00);
   SET_TRIS_C(0X00);
LAP:
   //TRANG THAI X1_D2
   OUTPUT_C (X1_D2);
   DEM1 = TG_XANH;
   DEM2 = TG_DO;
   DO
   {
      XUATLED7DOAN(MA7D[DEM1/10],MA7D[DEM1%10],MA7D[DEM2/10],MA7D[DEM2%10]);
      DELAY_MS(1000);
      DEM1--;
      DEM2--;
   }
   WHILE (DEM1!=255);
   //TRANG THAI V1_D2
   OUTPUT_C (V1_D2);
   DEM1 = TG_VANG;
   DO
   {
      XUATLED7DOAN(MA7D[DEM1/10],MA7D[DEM1%10],MA7D[DEM2/10],MA7D[DEM2%10]);
      DELAY_MS(1000);
      DEM1--;
      DEM2--;
   }                    
   WHILE (DEM1!=255);
   //TRANG THAI D1_X2
   OUTPUT_C (D1_X2);
   DEM1 = TG_DO;
   DEM2 = TG_XANH;
   DO
   {
      XUATLED7DOAN(MA7D[DEM1/10],MA7D[DEM1%10],MA7D[DEM2/10],MA7D[DEM2%10]);
      DELAY_MS(1000);
      DEM1--;
      DEM2--;
   }
   WHILE (DEM2!=255);
   //TRANG THAI D1_V2
   OUTPUT_C (D1_V2);
   DEM2 = TG_VANG;
   DO
   {
      XUATLED7DOAN(MA7D[DEM1/10],MA7D[DEM1%10],MA7D[DEM2/10],MA7D[DEM2%10]);
      DELAY_MS(1000);
      DEM1--;
      DEM2--;
   }
   WHILE (DEM1!=255);
   GOTO LAP;
}
