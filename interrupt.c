#INCLUDE <16F887.H>
#DEVICE ADC = 10
#FUSES HS
#USE DELAY (CLOCK = 20M)

UNSIGNED INT8 MA7DOAN [10] = {0XC0, 0XF9, 0XA4, 0XB0, 0X99, 0X92, 0X82, 0XF8, 0X80, 0X90};

UNSIGNED INT16 ND;
UNSIGNED INT8 DLHT[8] = {0XFF, 0XFF, 0XFF, 0XFF, 0XFF, 0XFF, 0X9C, 0XC6};

VOID HIENTHI()
{
   UNSIGNED INT8 I, Q, QUET;
   FOR (Q = 0; Q<30; Q++)
   {
      QUET=0XFE;//1111 1110
      FOR (I = 0; I<8; I++)
      {
         OUTPUT_D (QUET);
         OUTPUT_C (DLHT[I]);
         DELAY_US (300);
         OUTPUT_C (0XFF);
         QUET = (QUET<<1) + 1;//1111 1101
      }
   }
}
#INT_TIMER1
VOID NGAT()
{
   SET_TIMER1 (-5000);
   HIENTHI();
}
VOID MAIN()
{  
   SET_TRIS_D(0);
   SET_TRIS_C(0);
   ENABLE_INTERRUPTS (GLOBAL);
   ENABLE_INTERRUPTS (INT_TIMER1);
   SETUP_TIMER_1 (T1_INTERNAL|T1_DIV_BY_8);
   SET_TIMER1 (-5000);
   SETUP_ADC (ADC_CLOCK_INTERNAL);
   SETUP_ADC_PORTS (SAN5|VSS_VDD);
   SET_ADC_CHANNEL (5);
   DELAY_MS (10);
   WHILE (TRUE)
   {
      ND= READ_ADC()/2.046;//2
      DLHT[5]=MA7DOAN[ND%10];
      DLHT[4]=MA7DOAN[ND/10];
      DELAY_MS (1000);
   }
}

